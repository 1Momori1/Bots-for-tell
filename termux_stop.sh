#!/data/data/com.termux/files/usr/bin/bash

# –°–∫—Ä–∏–ø—Ç –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –±–æ—Ç–æ–≤ –¥–ª—è Termux
# –ê–≤—Ç–æ—Ä: Bot System
# –í–µ—Ä—Å–∏—è: 1.0

echo "üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º—ã –±–æ—Ç–æ–≤ –≤ Termux..."

# –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞
cd /storage/emulated/0/Bots 2>/dev/null || cd ~/Bots 2>/dev/null || {
    echo "‚ùå –ü–∞–ø–∫–∞ Bots –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!"
    exit 1
}

echo "üìÅ –†–∞–±–æ—á–∞—è –ø–∞–ø–∫–∞: $(pwd)"

# –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã Python —Å main.py
echo "üîÑ –ü–æ–∏—Å–∫ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –±–æ—Ç–æ–≤..."

# –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
pids=$(ps aux | grep "main.py" | grep -v grep | awk '{print $2}')

if [ -z "$pids" ]; then
    echo "‚ÑπÔ∏è –ù–µ –Ω–∞–π–¥–µ–Ω–æ –∑–∞–ø—É—â–µ–Ω–Ω—ã—Ö –±–æ—Ç–æ–≤"
else
    echo "üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤: $pids"
    
    # –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–∞–∂–¥—ã–π –ø—Ä–æ—Ü–µ—Å—Å
    for pid in $pids; do
        echo "üîÑ –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ $pid..."
        kill -TERM "$pid" 2>/dev/null
        
        # –ñ–¥–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
        sleep 2
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–≤–µ—Ä—à–∏–ª—Å—è –ª–∏ –ø—Ä–æ—Ü–µ—Å—Å
        if kill -0 "$pid" 2>/dev/null; then
            echo "‚ö†Ô∏è –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ $pid"
            kill -KILL "$pid" 2>/dev/null
        else
            echo "‚úÖ –ü—Ä–æ—Ü–µ—Å—Å $pid –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
        fi
    done
fi

# –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —É–±–∏–≤–∞–µ–º –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã —Å main.py
echo "üßπ –§–∏–Ω–∞–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞..."
pkill -f "main.py" 2>/dev/null || true

# –û—á–∏—â–∞–µ–º –ª–æ–≥–∏
echo "üßπ –û—á–∏—Å—Ç–∫–∞ –ª–æ–≥–æ–≤..."
for log_file in */telescan.log */mineserv.log */manager.log BotMonitor/bot_monitor.log; do
    if [ -f "$log_file" ]; then
        echo "# –õ–æ–≥ –æ—á–∏—â–µ–Ω $(date)" > "$log_file"
        echo "üßπ –û—á–∏—â–µ–Ω: $log_file"
    fi
done

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
echo ""
echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤:"
remaining=$(ps aux | grep "main.py" | grep -v grep)
if [ -z "$remaining" ]; then
    echo "‚úÖ –í—Å–µ –±–æ—Ç—ã –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã!"
else
    echo "‚ö†Ô∏è –û—Å—Ç–∞–ª–∏—Å—å –ø—Ä–æ—Ü–µ—Å—Å—ã:"
    echo "$remaining"
fi

echo ""
echo "‚úÖ –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!" 